function new_pat = T_CALC_LH( event, Nt, pat )
%T_CALC_LH Summary of this function goes here
%   Detailed explanation goes here
Lh = zeros(1, Nt);
hold on;
mLh = zeros(1, Nt);
for eps = 1:Nt
    misses = 0;
    shift = 0;
    Lh( eps ) = 1;
    xp = 0;
    ind = event( pat.Events( 1 ) ).indexes;
    x = min( abs( ind - eps * ones( 1, size(ind,2) ) ) );
    pr = normpdf(x, 0, 1);
    if pr > 0.00001
            %shift = shift + x - eps;
            %shift = shift + pat.CIs( i - 1, 1 ) + rx(1);
            Lh( eps ) = Lh( eps ) * pr;
    else
            %shift = shift + pat.CIs( i - 1, 1 );
            misses = misses + 1;
    end
        
    prevrx = -1;
    for i = 2 : size( pat.Events, 2)
        ind = event( pat.Events( i ) ).indexes;
        ind = ind( ind > prevrx );
        tmp = ind - ( eps + shift + pat.CIs(i-1, 1) ) * ones( 1, size(ind,2) );
        
        x = min( abs( tmp ) );
        rx = tmp( find(abs(tmp)==x) );
        prevrx = rx(1) + eps + shift + pat.CIs(i-1, 1);
        pr = normpdf( x, 0, pat.CIs( i - 1, 2 ) );
        if pr > 0.00001
            %shift = shift + x - eps;
            shift = shift + pat.CIs( i - 1, 1 ) + rx(1);
            Lh( eps ) = Lh( eps ) * pr;
        else
            shift = shift + pat.CIs( i - 1, 1 );
            misses = misses + 1;
        end
    end
    Lh( eps ) = Lh( eps ) * T_LOSS_FUN( misses, size( pat.Events, 2 ) );
    mLh( eps ) = misses;
end
plot (Lh, 'Color', 'b', 'LineWidth', 2);
plot (1:Nt, mLh/10*(max(Lh)), '-', 'Color', 'r');
for j = 1 : size( pat.Events, 2 ) 
    ind = []
    for i = 1 : size( pR.DS, 2 )
        ind2( size(ind2, 2)+1 ) = pR.DS(i).ind(1);
    end
    
    plot( ind1, 1*ones( 1, size(ind1,2) ), 's', 'Color', 'r');
    plot( ind2, 2*ones( 1, size(ind2,2) ), 's', 'Color', 'r');
end
sum(Lh)
new_pat=Lh;
end

