\section{Теоретическое обоснование. Определения}
  \subsection{Наблюдаемый временной ряд}
Пусть время наблюдения разбито на $N_t$ интервалов. В каждый момент {\itshape периода наблюдения(observation period)} $[1,N_t]$ 
может произойти некoторое 
событие({\itshape действие, event}) \footnote{ Чаще всего понимается, что в этот момент времени имеет место {\itshape начало} действия} из 
множества допустимых событий $\mathcal{E}$ ({\itshape event types}). Соответственно, каждому типу событий сопоставляется множество моментов 
времени.
  \subsection{Понятие критического интервала}
Во время поиска закономерностей в данных, нас интересуют отношения между распределениями отдельных событий. Если предположить, что в исходных
не существует никаких закономерностей, то каждое событие должно появляться независимо, от других; то есть распределение компонент должно быть 
независимым. Но паттерн характеризуется 
появлением своих компонент в одинаковом порядке, более того, временные интервалы, разделяющие компоненты, должны быть примерно одинаковыми.

Будем говорить, что события $\eA$ и $\eB$ связаны отношением {\itshape критического интервала (Critical Interval, CI)}, если, после появления 
события $\eA$ в момент времени $t$, существует интервал $[t+d_1,t+d_2],\ (d2\geqslant d1\geqslant0)$, содержащий $\eB$, чаще, 
чем это ожидается из предположения о независимости событий. Данную взаимосвязь будем обозначать как $\eA[d_1, d_2]\eB$.

Далее раскроем понятие <<чаще чем это ожидается>>. Пусть $N_{\eA}$ и $N_{\eB}$~--- количество возникновений $\eA$ и $\eB$, соответственно, в течение $[1,N_t]$. $P(\eA)=N_{\eA}/N_t$~--- вероятность появления события $\eA$ в некоторый момент времени; 
$P(\neg\eA)=1-P(\eA)$, где
$P(\neg\eA)^d$~--- вероятность, что $\eA$ не появится в течение какого-либо интервала $[d_1,d_2],~(d=d_2-d_1+1)$, длины $d$. Вероятность наблюдать $\eA$ на
интервале длины $d$, один или более раз равна $1-P(\neg\eA)^d$. 

Зафиксируем события $\eA$, $\eB$, и длину интервала $d$. Приняв гипотезу о независимом распределении событий, событие $\eB$,
содержится\footnote{Один или более раз. } в интервале длины $d$, после события $\eA$,~ $N_{\eA}*(1-P(\neg\eB)^d)$ раз.
$$\rho=P(\geqslant N_{\eA\eB})=1-P(<N_{\eA\eB})$$~---~априорная вероятность  того, что $N_{\eA\eB}$ из $N_\eA$ интервалов содержат вхождения $\eB$.
Очевидно, что $P(<N_{\eA\eB})$  распределено по биномиальному закону, где $N_{\eA}$~---~количество <<испытаний>>, $1-P(\neg\eB)^d$~---~вероятность <<успеха>>. Следовательно, 
$$\rho = P(\geqslant N_{\eA\eB}) = 1 - \sum_{i=0}^{N_{\eA\eB}-1}C_{N_{\eA}}^i( 1-P(\neg\eB)^d )^iP(\neg\eB)^{N_{\eA}-i}$$.

Полученная вероятность $\rho$ сравнивается с пороговым значением $\alpha$, являющимся структурным параметром поиска: если $\rho\leqslant\alpha$,
то заданный интервал признается критическим. Заметим, что $\rho$ зависит от $N_{\eA},N_{\eB},N_t,N_{\eA\eB},d$: 
$$\rho=\rho(N_{\eA}, N_{\eB}, N_t, N_{\eA\eB}, d)$$
  \subsection{Определение Т-Паттерна}
Дадим рекурсивное определение Т-Паттерна. Договоримся называть каждое допустимое событие {\itshape псевдопаттерном}. 
Тогда Т-Паттерн ${\bf Q}$ можно определить как:
 $${\bf Q}={\bf X_1}[dL_1, dR_1]{\bf X_2}[dL_2, dR_2]\dots {\bf X_i}[dL_i, dR_i]{\bf X_{i+1}}\dots {\bf X_m},$$ 
где ${\bf X_i},(i=1\dots m)$~--- Т-Паттерн, или псевдопаттерн. 
Для паттернов отношение критического интервала ${\bf Q_L}[dL, dR]{\bf Q_R}$ вводится, как и для событий, с учетом того, 
что интервал $[dL, dR]$ отсчитывается от последнего элемента ${\bf Q_L}$, и вхождение ${\bf Q_R}$ определяется его первым элементом.  
Будем называть {\itshape двойными сериями(double series, DS)} паттерна ${\bf Q}$, множество $\{\{Left_i, Right_i \}_{ i=1\dots N_Q}\}$, где $N_Q$~--- количество 
появлений паттерна ${\bf Q}$, $Left_i, Right_i$~--- индексы начального и конечного события $i$-го появления паттерна ${\bf Q}$. 
\section{Алгоритм поиска Т-Паттернов}

  \section{Формальное описание}
  \begin{algorithmic}[1]

\Require $\mathcal{E}$~--- допустимые события, $N_t~--- продолжительность наблюдения, \alpha~--- минимальный уровень значимости, N_{min}~--- минимальное 
количество вхождений паттерна$
\State $\mathcal{D}_{-1}=\emptyset$
\State $\mathcal{D}_0=\mathcal{E}$ \Comment {Инициализируем множество паттернов}
\State $t=0$
\While  {$\mathcal{D}_t\neq\mathcal{D}_{t-1}$}
\State $t=t+1$
\State  $\mathcal{D}_t=\mathcal{D}_{t-1}$
  \For{ $P_L \in \mathcal{D}_{t-1}$ }
    \For{ $P_R \in \mathcal{D}_{t-1}$ }
      \ForAll{ $d_L, d_R \in [1,N_t]$ таких, что $d_L\leqslant d_R$ }
	\If{ $\rho( N_{P_L}, N_{P_R}, N_t, N_{P_LP_R}, d_R-d_L+1 ) < \alpha$ }
	  \If{ isUnique($P_L\cup P_R, \mathcal{D}_t $) }
	    \State $\mathcal{D}_t = \mathcal{D}_t \cup \{P_L \cup P_R\}$
	  \EndIf
	\EndIf
      \EndFor
    \EndFor
  \EndFor
\For{ $P_L \in \mathcal{D}_{t}$ }
    \For{ $P_R \in \mathcal{D}_{t}$ }
      \If{ $P_L\subset P_R$\footnote{Имеется в виду упорядоченная вложенность множеств. Т.е. $abd\subset abcd$, но $bdc\not\subset abcd$ } {\bf and} |DS($P_L$)|=|DS($P_R$)| 
{\bf and} isIntersect($P_L, P_R$)} 
	\State удалить $P_L$ из $\mathcal{D}_t$
      \EndIf
    \EndFor
\EndFor
\EndWhile
\Function{isUnique}{$Q, \mathcal{D}$}
  \For{$P \in \mathcal{D}$}
    \If{ DS($Q$)=DS($P$) }
      \State {\bf return false} 
    \EndIf
  \EndFor
  \State {\bf return true}
\EndFunction
\Function{isIntersect}{$P_L, P_R$}
  \For{$i=1\dots|DS(P_L)|$}
    \If{ $DS_{i,Left}(P_L)$>$DS_{i,Right}(P_R)$ {\bf or} $DS_{i,Right}(P_L)<DS_{i,Left}(P_R)$}
	\State {\bf return false}
    \EndIf
    \State {\bf return true}
  \EndFor
  \State {\bf return true}
\EndFunction
  \end{algorithmic}
